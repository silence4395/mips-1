# this is duplicate with ../test/cases/OMakefile
.PHONY: clean command.sim vim.sim vim.test rukako.sim

COMPILER = ../src/main
ASSEMBLER = ../../assembler/assembler
SIMULATOR = ../../simulator/simulator
LINKER = ../helper/linker.sh

%.bin: %.s
	$(ASSEMBLER) $< $@

%.s: %.c ../helper/assembly.s
	$(COMPILER) $< > /dev/null
	$(LINKER) $@

clean:
	rm -f *.s *.sim *.bin

.BUILD_SUCCESS:
	true

.BUILD_FAILURE:
	true

command.sim: command.bin
	$(SIMULATOR) $< -k test/command$(CASE).case -x $(OPTION)

vim.sim: vim.bin
	$(SIMULATOR) $< -k test/vim/$(CASE).case $(OPTION)

rukako.sim: rukako.bin
	$(SIMULATOR) $< -f test/rukako/$(CASE).lisp

.SUBDIRS: test/vim test/rukako
