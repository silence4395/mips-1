# Mimic

東京大学 理学部情報科学科 3年 冨田寛

# Concept

The "fastest" implementation for CPU Ex.

# 「速さ」とはなにか

従来の CPU 実験: レイトレーサを高速に動作させること

私の CPU 実験: レイトレーサを動作させるプロダクトを短期間で作成すること

# 結果

本番アーキテクチャ設計開始から**10人日**で実機動作

110.26s (おそい!)

## CPU 仕様

- マルチクロックサイクル(可変サイクル数)
- 66MHz(標準クロックでぴったり)
- 32bit 
- 32 本レジスタ * 2 (GPR, FPR)

## コンパイラ・ライブラリ

CPUExSolver2 を使用

- 命令セットのカスタマイズ性が足りなかったので管理方法を改善(ad-hoc)
- GUI が使いにくかったので XML 単体で扱いやすいように変更

## シミュレータ・アセンブラ

CPUExSolver2 の生成したものを改造。

出来あいのはデバッグ能力に欠けるので、命令流、データ流のダンプコードを追加。

## CPU・FPU

フルスクラッチで作成。

ハードウェア実験の資産を活用(FPU、RS232C、SRAM)。

# 「速さ」のために

アジャイル、XP のプラクティスを参考。

- イテレーティブな開発
- フィードバックループ
- テスト駆動開発

## イテレーティブな開発

いきなり目標を目指さない。到達可能な地点を目指す。

問題の分割。

- fib
- 行列計算
- マンデルブロ
- レイトレ

## フィードバックループ

正しい方向に進んでいるかを常に確認する。

- ソフトウェア実装、CPU シミュレータ
- 組み合わせ回路のテスト
- HDL シミュレータ
- 実機(ダンプコードあり)
- 実機(大会レギュレーション)

## テスト駆動開発

実際にイテレーティブかつフィードバックを得ながら開発するガイドライン

- 動作させたい部分が動作していることを保証できるプログラムを書く(アセンブラ、ML)
- CPU シミュレータで目的が達成できることを確認する
- 回路を記述し、 HDL シミュレータで動作することを命令、ビットレベルで確認する
- 実機に載せて動作することを確認する

参考: [TDDを明確に定義する - うさぎ組](http://d.hatena.ne.jp/kyon_mm/20120830/1346344839)

# くわしくは

[CPU 実験完動報告 - tomykaira makes love with codes](http://tomykaira.hatenablog.com/entry/2012/09/19/012014)

環境、流れ、作った/使ったツールに言及しているので実験で参考になるはず。

# 謝辞

- @atetubou さん
- @furaga さん
- 細川さん
- @h013 さん、@iwiwi さん

# まとめ

- ひとつの課題
- ことなる目標
- ことなる速さ
